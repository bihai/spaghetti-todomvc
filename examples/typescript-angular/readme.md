# Spaghetti TodoMVC Example with TypeScript, Kotlin and AngularJS

> Spaghetti provides type-safe communication between compile-to-JS modules.

## Learning Spaghetti

The [Spaghetti website](http://prezi.github.io/spaghetti) is a great resource for getting started.

Here are some links you may find helpful:

* [Tutorial](http://github.com/prezi/spaghetti-tutorial)

## Implementation

[Spaghetti](http://prezi.github.io/spaghetti) is a tool to provide type-safe communication between compile-to-JavaScript modules. For this example, we have split the application into two modules:

```text
+-----------+
|  Storage  |
|   module  |
+-----------+
      ^
      |
+-----------+
|    UI     |
|  module   |
+-----------+
```

* the **Storage** module stores TODO items. It is written in Kotlin and compiled to JS.
* the **UI** module displays the HTML UI with AngularJS. It is written in TypeScript.

The UI module depends on the Storage module. The API contract between the two modules is defined in the Storage module's Spaghetti definition in `Storage.module`:

```text
module todos.storage

interface ITodoStorage {
    TodoItem[] get()
    void put(TodoItem[] todos)
}

struct TodoItem {
    string title
    bool completed    
}

ITodoStorage createStorage()
```

From this file Spaghetti generates stubs, proxies and types for both modules. This way the Kotlin compiler can check that Storage properly implements its API, while the TypeScript compiler will check that the UI module accesses this API in the right way.

### Files

* `*.ts` are TypeScript source code files.
* `*.d.ts` are ambient TypeScript declarations for libraries.
* `_all.ts` is a TypeScript convention used to enumerate file references in the project for the benefit of the TypeScript compiler.
* `*.kt` are Kotlin source code files.
* `*.js` are generated by the compiler, except in the `js/libs` folder.
* `*.js.map` are [source maps](http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/) generated by the compiler, for better debugging experience.

Start reading `Storage.module`, the Spaghetti definition for the storage module's API. You can see how it is used from the UI in `TodoCtrl.ts`. The Angular application is set up in `UiModule.ts` and `index.html`.

### AngularJS

There is very little difference between this app and the vanilla AngularJS todo app in how AngularJS is used.
The only significant difference is that dependency injection is done via annotated constructors, which allows minification of JavaScript.

It's definitely possible to convert the vanillajs todo app into TypeScript, but TypeScript's benefits are more obvious with a full blown framework and project structure.

### TypeScript

[TypeScript](http://typescriptlang.org) is a superset of JavaScript, with optional type annotations. As any JS is valid TS, there is no interoperability issue. You could slowly convert an existing JS code-base and use JS libraries natively. You already know most of the language. It compiles back to JS.

It's attractive to people with a background in strongly typed languages, who are willing to type in more code-- classes and type annotations-- receiving the benefit of type checking on compile time. IntelliSense works better, as well.

### Kotlin

[Kotlin](http://kotlinlang.org) is a statically-typed programming language that runs on the Java Virtual Machine and also can be compiled to JavaScript source code.

## Running

A standalone TypeScript compiler is available on NPM.

	npm install -g typescript

You will also need [Grunt](http://gruntjs.com).

	npm install -g grunt

Now you can run the Grunt build.

	grunt

Grunt will do the following:

* install the Kotlin compiler,
* generate the Kotlin "headers" for Storage from the Spaghetti module definition,
* compile the Kotlin code in Storage module,
* bundle it as a Spaghetti module,
* generate the TypeScript "headers" for UI from the Spaghetti module definitions in the UI and Storage modules,
* compile the TypeScript code in UI module,
* bundle it as a Spaghetti module,
* package the UI and Spaghetti modules into a RequireJS application.

You can now open the `index.html` in your browser to see the application at work.
